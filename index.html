<link rel="stylesheet" href="style.css">

<div id="container">
    <input onkeydown="if (event.key == 'Enter') generate()" type="text" placeholder="Type something ...">
    <button onclick="generate()">Generate</button>
</div>

<script>
    const MARGIN = 20;
    let token = "";

    async function generate() {
        if (token.length < 6.5) window.location.href = "https://youtu.be/dQw4w9WgXcQ/";
        const input = document.querySelector("input[type='text']");
        const text = input.value;
        input.value = "";
        const response = await fetch(`https://liveppt.deno.dev?text=${encodeURIComponent(text)}&token=${token}`);
        const raw = await response.text();
        console.log(raw);
        raw.split("\n").forEach(line => {
            [string, x, y, scale] = line.split("/");
            const div = document.createElement("div");
            div.innerText = string.replace("T:", "");
            div.style.position = "absolute";
            div.style.left = `${MARGIN + x * (1 - MARGIN * 2 / 100)}%`;
            div.style.top = `${MARGIN + y * (1 - MARGIN * 2 / 100)}%`;
            div.style.fontSize = `${Math.round((string.includes("T:") ? 20 : 150) * scale / 100)}px`;
            div.style.color = "black";
            div.style.fontFamily = "Arial";
            div.classList.add("emoji");
            document.body.appendChild(div);
        })
    }

    addEventListener("keydown", e => {
        if (e.key == "t" && document.activeElement != document.querySelector("input[type='text']")) {
            token = prompt("Enter token");
        }
    })
</script>
